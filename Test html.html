<!DOCTYPE html>
<html>
<body>

<h1>Employee administration</h1>
<div style="display:flex;">
<!--<label for="cars">Choose aggregation:</label>-->
<label>Choose aggregation:</label>
<select name="firstChoice" id="first">
  <option value="project">Project</option>
  <option value="employee">Employee</option>
  <option value="date">Date</option>
</select>
<br><br>
<select name="secondChoice" id="second">
  <option value="none">None</option>
  <option value="project">Project</option>
  <option value="employee">Employee</option>
  <option value="date">Date</option>
</select>
<br><br>
<select name="thirdChoice" id="third">
  <option value="none">None</option>
  <option value="project">Project</option>
  <option value="employee">Employee</option>
  <option value="date">Date</option>
</select>
</div>
<br><br>
<button id="submit">Submit</button>

<table id="table" align = "center" border="1px"></table>
</body>
<script>
  var f = document.getElementById("first");
  var s = document.getElementById("second");
  var t = document.getElementById("third");
  var returnValue;

  document.getElementById("third").setAttribute("disabled", "disabled");

  var op = s.getElementsByTagName("option");
    for (var i = 0; i < op.length; i++) {
    // lowercase comparison for case-insensitivity
    (op[i].value.toLowerCase() == "project")
      ? op[i].disabled = true 
      : op[i].disabled = false ;
    }

  document.getElementById("first").onchange = function () {
    var op = s.getElementsByTagName("option");
    for (var i = 0; i < op.length; i++) {
    // lowercase comparison for case-insensitivity
    (op[i].value.toLowerCase() == f.value)
      ? op[i].disabled = true 
      : op[i].disabled = false ;
    }
  };

  document.getElementById("second").onchange = function () {
    if (this.value != 'none')
      document.getElementById("third").removeAttribute("disabled");
    else
      document.getElementById("third").setAttribute("disabled", "disabled");

    var op = t.getElementsByTagName("option");
    for (var i = 0; i < op.length; i++) {
    // lowercase comparison for case-insensitivity
    (op[i].value.toLowerCase() == s.value)
      ? op[i].disabled = true 
      : op[i].disabled = false ;
    }
  };

  document.getElementById('submit').addEventListener('click', () => {

        let request = new XMLHttpRequest();

        request.open("POST", "https://localhost:44339/api/aggregations/selectaggregations");
        request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        request.send(
          JSON.stringify({
                          First: f.value,
                          Second: s.value,
                          Third: t.value,
                      }));
        request.onload = () => {
            console.log(request);
            if(request.status == 200){
                returnValue = JSON.parse(request.response);
                ShowResponse(returnValue);
            }else{
                console.log("Error");
            }
        }

    })
         
    /*var list = [
        {"project":"Uno", "employee":"Tizio", "date":"", "Hours":"3"},
        {"project":"Uno", "employee":"Caio", "date":"","Hours":"5"},
        {"project":"Due", "employee":"Quello", "date":"","Hours":"8"}
    ];*/
     
    function ShowResponse(returnValue) {
        var cols = [];
        cols.push(f.value);
        cols.push(s.value);
        cols.push(t.value);
        cols.push("hours");
         
        /*for (var i = 0; i < list.length; i++) {
            for (var k in list[i]) {
                if (cols.indexOf(k) === -1) {
                     
                    // Push all keys to the array
                    cols.push(k);
                }
            }
        }*/
         
        // Create a table element
        var table = document.createElement("table");
         
        // Create table row tr element of a table
        var tr = table.insertRow(-1);
         
        for (var i = 0; i < cols.length; i++) {
             
            // Create the table header th element
            var theader = document.createElement("th");
            theader.innerHTML = cols[i];
             
            // Append columnName to the table row
            tr.appendChild(theader);
        }
         
        // Adding the data to the table
        for (var i = 0; i < returnValue.length; i++) {
             
            // Create a new row
            trow = table.insertRow(-1);
            for (var j = 0; j < cols.length; j++) {
                var cell = trow.insertCell(-1);
                 
                // Inserting the cell at particular place
                cell.innerHTML = returnValue[i][cols[j]];
            }
        }
         
        // Add the newly created table containing json data
        var el = document.getElementById("table");
        el.innerHTML = "";
        el.appendChild(table);
    }   
</script>
</html>
